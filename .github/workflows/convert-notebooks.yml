name: ğŸ“š Convert Notebooks to Documentation

on:
  workflow_dispatch:
    inputs:
      commit_changes:
        description: 'Commit converted files back to repo'
        required: false
        default: 'true'
        type: boolean

jobs:
  convert-notebooks:
    name: ğŸ”„ Convert Jupyter Notebooks
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout repository
      uses: actions/checkout@v4
      
    - name: ğŸ Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
        
    - name: ğŸ“¦ Install nbconvert
      run: pip install nbconvert
        
    - name: ğŸ”„ Convert notebooks
      run: |
        chmod +x docs3/scripts/smart_convert.sh
        ./docs3/scripts/smart_convert.sh
        
    - name: ğŸ“ Add frontmatter and convert to MDX
      run: |
        chmod +x docs3/scripts/add_frontmatter.py
        python3 docs3/scripts/add_frontmatter.py
        
    - name: ğŸ“Š Show conversion results
      run: |
        echo "ğŸ“ˆ Conversion Summary:"
        echo "   ğŸ“ Total MDX files: $(find docs3/docs/examples -name '*.mdx' -not -name 'index.mdx' | wc -l)"
        echo "   ğŸ“ Categories processed:"
        for dir in docs3/docs/examples/*/; do
          if [ -d "$dir" ]; then
            count=$(find "$dir" -name '*.mdx' -not -name 'index.mdx' | wc -l)
            echo "      $(basename "$dir"): $count files"
          fi
        done
        
    - name: ğŸ’¾ Commit converted files
      if: ${{ github.event.inputs.commit_changes == 'true' }}
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        git add docs3/docs/examples/
        if git diff --staged --quiet; then
          echo "No changes to commit"
        else
          git commit -m "Auto-convert notebooks to documentation"
          git push
