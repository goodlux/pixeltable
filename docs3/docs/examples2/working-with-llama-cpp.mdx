---
title: "working with llama cpp"
description: "Jupyter notebook example for Pixeltable"
---

[![Kaggle](https://kaggle.com/static/images/open-in-kaggle.svg)](https://kaggle.com/kernels/welcome?src=https://github.com/pixeltable/pixeltable/blob/release/docs/notebooks/integrations/working-with-llama-cpp.ipynb)  
[![Colab](https://colab.research.google.com/assets/colab-badge.svg)](https://colab.research.google.com/github/pixeltable/pixeltable/blob/release/docs/notebooks/integrations/working-with-llama-cpp.ipynb)  
`<a href="https://raw.githubusercontent.com/pixeltable/pixeltable/release/docs/notebooks/integrations/working-with-llama-cpp.ipynb" download>`\{=html\}`<img src="https://img.shields.io/badge/%E2%AC%87-Download%20Notebook-blue" alt="Download Notebook" / />`\{=html\}`</a>`\{=html\}

# Working with llama.cpp in Pixeltable

This tutorial demonstrates how to use Pixeltable's built-in `llama.cpp`
integration to run local LLMs efficiently.

**If you are running this tutorial in Colab:** In order to make the
tutorial run a bit snappier, let's switch to a GPU-equipped instance for
this Colab session. To do that, click on the
`Runtime -> Change runtime type` menu item at the top, then select the
`GPU` radio button and click on `Save`.

### Important Notes

-   Models are automatically downloaded from Hugging Face and cached
    locally
-   Different quantization levels are available for performance/quality
    tradeoffs
-   Consider memory usage when choosing models and quantizations

## Set Up Environment

First, let's install Pixeltable with llama.cpp support:

## Create a Table for Chat Completions

Now let's create a table that will contain our inputs and responses.

    Connected to Pixeltable database at: postgresql+psycopg://postgres:@/pixeltable?host=/Users/asiegel/.pixeltable/pgdata
    Created directory `llama_demo`.
    Created table `chat`.

Next, we add a computed column that calls the Pixeltable
`create_chat_completion` UDF, which adapts the corresponding llama.cpp
API call. In our examples, we'll use pretrained models from the Hugging
Face repository. llama.cpp makes it easy to do this by specifying a
repo_id (from the URL of the model) and filename from the model repo;
the model will then be downloaded and cached automatically.

(If this is your first time using Pixeltable, the
`<a href="https://docs.pixeltable.com/docs/tables-and-data-operations">`\{=html\}Pixeltable
Fundamentals`</a>`\{=html\} tutorial contains more details about table
creation, computed columns, and UDFs.)

For this demo we'll use `Qwen2.5-0.5B`, a very small (0.5-billion
parameter) model that still produces decent results. We'll use `Q5_K_M`
(5-bit) quantization, which gives an excellent balance of quality and
efficiency.

    Added 0 column values with 0 errors.
    Added 0 column values with 0 errors.





    UpdateStatus(num_rows="0", num_computed_values="0", num_excs="0", updated_cols=[], cols_with_excs=[])

## Test Chat Completion

Let's try a simple query:

    Computing cells: 100%|████████████████████████████████████████████| 9/9 [00:03<00:00,  2.25 cells/s]
    Inserting rows into `chat`: 3 rows [00:00, 1112.74 rows/s]
    Computing cells: 100%|████████████████████████████████████████████| 9/9 [00:03<00:00,  2.25 cells/s]
    Inserted 3 rows with 0 errors.





    UpdateStatus(num_rows="3", num_computed_values="9", num_excs="0", updated_cols=[], cols_with_excs=[])

<table border="1" className="dataframe">
<thead>
<tr style={{'text-align: right;'}}>
<th>
input
</th>
<th>
output
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
What is the capital of France?
</td>
<td>
Paris is the capital of France.
</td>
</tr>
<tr>
<td>
What are some edible species of fish?
</td>
<td>
Here are some edible species of fish that you may consider: 1. Tilapia
2. Cod 3. Salmon 4. Trout 5. Mahi-mahi (Mako) 6. Bluefish 7. Eel 8.
Sardines 9. Shrimps 10. Scallops Remember to check the environmental
impact of fishing and take steps to protect wildlife and the ocean.
</td>
</tr>
<tr>
<td>
Who are the most prominent classical composers?
</td>
<td>

The most prominent classical composers in the world are often referred
to as \"The Great Composers\" or \"The Four Great Composers\" in Western
classical music, and include the following composers:

1.  Beethoven - The most famous and influential classical composer of
    all time, with over 2, 000 concertos, sonatas, and symphonies.
    Beethoven\'s works have influenced generations of musicians,
    composers, and listeners.

2.  Bach - Another famous classical composer of the 17th and 18th
    centuries. His wo ...... and prolific classical composer of the late
    18th and early 19th centuries. His works include the opera \"Don
    Giovanni,\" the symphonies, the string quartets, and the concerto
    \"Piano Concerto No. 20.\"

3.  Chopin - A Polish classical composer of the 19th century, known for
    his compositions of the Chopin Suite No. 1, the Ballade No. 2 in A
    minor, and the Waltz \"Tante Marie.\"

These composers are still celebrated today and are widely regarded as
some of the greatest classical composers in history.
</td>
</tr>
</tbody>
</table>

## Comparing Models

Local model frameworks like `llama.cpp` make it easy to compare the
output of different models. Let's try comparing the output from `Qwen`
against a somewhat larger model, `Llama-3.2-1B`. As always, when we add
a new computed column to our table, it's automatically evaluated against
the existing table rows.

    Computing cells: 100%|████████████████████████████████████████████| 3/3 [00:08<00:00,  2.74s/ cells]
    Added 3 column values with 0 errors.
    Computing cells: 100%|███████████████████████████████████████████| 3/3 [00:00<00:00, 349.89 cells/s]
    Added 3 column values with 0 errors.

<table border="1" className="dataframe">
<thead>
<tr style={{'text-align: right;'}}>
<th>
input
</th>
<th>
output
</th>
<th>
output_l3
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
What is the capital of France?
</td>
<td>
Paris is the capital of France.
</td>
<td>
The capital of France is Paris.
</td>
</tr>
<tr>
<td>
What are some edible species of fish?
</td>
<td>
Here are some edible species of fish that you may consider: 1. Tilapia
2. Cod 3. Salmon 4. Trout 5. Mahi-mahi (Mako) 6. Bluefish 7. Eel 8.
Sardines 9. Shrimps 10. Scallops Remember to check the environmental
impact of fishing and take steps to protect wildlife and the ocean.
</td>
<td>

Here are some popular edible species of fish:

**Warm-Weather Fish:**

1.  Grouper (Epinephelus spp.): found in tropical and subtropical
    waters, these fish are rich in protein and low in fat.
2.  Mahi-Mahi (Coryphaena hippurus): a popular game fish with a flavor
    similar to swordfish.
3.  Snapper (Lutjanus spp.): found in warm waters, these fish are known
    for their mild flavor and firm texture.
4.  Wahoo (Acanthurus triangularis): a fast-swimming fish with a rich,
    buttery flavor.
5.  Sailfish (Ist ...... fish with a meaty texture and rich flavor.
6.  Marlin (Makaira mazara): a fast-swimming fish with a rich, buttery
    flavor.
7.  Bluefin Tuna (Thunnus thynnus): a highly prized fish with a rich,
    savory flavor.
8.  Sharks (various species): while not typically considered a \"fish,\"
    sharks are an important food source for many cultures.

**Wild-Caught Fish:**

1.  Sablefish (Dicentrarchus labrax): a fatty fish with a rich, buttery
    flavor.

2.  Eel (Anguilla anguilla): a soft, sweet fish with a delicate

    </td>
    </tr>
    <tr>
    <td>

    Who are the most prominent classical composers?

    </td>
    <td>

    The most prominent classical composers in the world are often
    referred to as \"The Great Composers\" or \"The Four Great
    Composers\" in Western classical music, and include the following
    composers:

3.  Beethoven - The most famous and influential classical composer of
    all time, with over 2, 000 concertos, sonatas, and symphonies.
    Beethoven\'s works have influenced generations of musicians,
    composers, and listeners.

4.  Bach - Another famous classical composer of the 17th and 18th
    centuries. His wo ...... and prolific classical composer of the late
    18th and early 19th centuries. His works include the opera \"Don
    Giovanni,\" the symphonies, the string quartets, and the concerto
    \"Piano Concerto No. 20.\"

5.  Chopin - A Polish classical composer of the 19th century, known for
    his compositions of the Chopin Suite No. 1, the Ballade No. 2 in A
    minor, and the Waltz \"Tante Marie.\"

These composers are still celebrated today and are widely regarded as
some of the greatest classical composers in history.
</td>
<td>

Here\'s a list of some of the most prominent classical composers:

1.  **Claude Debussy (1862-1918)**: French composer known for his
    Impressionist and Symbolist music, particularly for the piano and
    orchestral works.
2.  **Ludwig van Beethoven (1770-1827)**: German composer and pianist
    who revolutionized classical music with his symphonies, piano
    sonatas, and chamber music.
3.  **Wolfgang Amadeus Mozart (1756-1791)**: Austrian composer of Mozart
    and his brother, widely regarded as one of the gre ...... or who
    pioneered the art of opera seria, particularly with his epic opera,
    Das Rheingold.
4.  **Antonín Dvořák (1841-1904)**: Czech composer known for his
    symphonies, opera, and chamber music, which reflect the spirit of
    his homeland.
5.  **George Frideric Handel (1685-1759)**: German-born British composer
    and organist famous for his operas, orchestral suites, and church
    music.
6.  **Carl Maria von Weber (1786-1826)**: German composer who was a key
    figure in the development of Romantic music,
    </td>
    </tr>
    </tbody>
    </table>

Just for fun, let's try running against a different system prompt with a
different persona.

    Computing cells: 100%|████████████████████████████████████████████| 3/3 [00:06<00:00,  2.30s/ cells]
    Added 3 column values with 0 errors.
    Computing cells: 100%|███████████████████████████████████████████| 3/3 [00:00<00:00, 605.33 cells/s]
    Added 3 column values with 0 errors.

<table border="1" className="dataframe">
<thead>
<tr style={{'text-align: right;'}}>
<th>
input
</th>
<th>
output_teacher
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
What is the capital of France?
</td>
<td>

Bonjour! Don\'t worry if you didn\'t know that already. The capital of
France is actually called Paris. But just to clarify, I\'d like to break
it down in a way that\'s easy to understand.

In simple terms, the capital of a country is the city where it\'s
located. France, like many other countries, has a big city called Paris,
which is its capital.

If we think of it like this:

-   The country (France) = where it\'s located
-   The city (Paris) = where the government, or the capital, is located

Now, the capital is a very special city, and it\'s home to a lot of
